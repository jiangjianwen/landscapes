sudo: required
dist: trusty

language: cpp
compiler:
  - gcc
  #- clang
env:
  global:
    - CMAKE_GENERATOR="Unix Makefiles"
    - CMAKE_DEPS_BUILD_TYPE=Release
    - GTEST_BUILD_TYPE=Release
  matrix:
    - CMAKE_BUILD_TYPE=Release SGFXAPI_BUILD_TYPE=Release
    - CMAKE_BUILD_TYPE=Debug SGFXAPI_BUILD_TYPE=Debug
    

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-4.8
    - g++-4.8
    - clang
    - mercurial
    # for cegui
    - libfreetype6-dev
    - libpcre3-dev
    - libsilly-dev
    - libxml2-dev
    - libexpat1-dev 
    - libosmesa6
    - libglapi-mesa
    - mesa-utils
    - libglew-dev
    - libglfw-dev
    #- libglm-dev
    #- wget
    #- ca-certificates #for wget
    #- libglm-dev

install:
    - if [ "$CXX" = "g++" ]; then export CXX="g++-4.8" CC="gcc-4.8"; fi
    #takes too long, we'll download the binaries instead.
    #- sudo bash ./scripts/build-install-cmake3.sh
    #- sudo bash ./scripts/download-install-cmake3.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$GTEST_BUILD_TYPE" bash ./scripts/download-and-build-googletest.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-glm.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-corner-cases.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-cnbt.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-mathgeolib.sh
    
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-cegui-dependencies.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-cegui.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-tclap.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-glfw3.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-freeglut.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_BUILD_TYPE" bash ./scripts/download-and-build-sgfxapi.sh

    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-and-build-libs-with-no-pkg.sh
    - CMAKE_GENERATOR="$CMAKE_GENERATOR" CMAKE_BUILD_TYPE="$CMAKE_DEPS_BUILD_TYPE" bash ./scripts/download-unittest-data.sh


script:
    - mkdir -p build && cd build
    - cmake -G "$CMAKE_GENERATOR" .. "-DGTEST_LIB=gtest;pthread" -DCMAKE_VERBOSE_MAKEFILE=1 -DCMAKE_BUILD_TYPE="$CMAKE_BUILD_TYPE"
    - cmake --build . --target unittests
    - cmake --build . --target landscapes-zorder-genconsts
    - ./unittests



